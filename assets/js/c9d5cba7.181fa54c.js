"use strict";(self.webpackChunkorbit_website=self.webpackChunkorbit_website||[]).push([[4094],{3905:function(e,t,a){a.d(t,{Zo:function(){return d},kt:function(){return u}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=p(a),u=r,h=m["".concat(l,".").concat(u)]||m[u]||c[u]||i;return a?n.createElement(h,o(o({ref:t},d),{},{components:a})):n.createElement(h,o({ref:t},d))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},9982:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return d},default:function(){return m}});var n=a(3117),r=a(102),i=(a(7294),a(3905)),o=["components"],s={title:"Data sources"},l=void 0,p={unversionedId:"data-sources",id:"data-sources",title:"Data sources",description:"Sources provide access to data. They vary widely in their capabilities: some",source:"@site/docs/data-sources.md",sourceDirName:".",slug:"/data-sources",permalink:"/docs/data-sources",editUrl:"https://github.com/orbitjs/orbit/edit/main/website/docs/data-sources.md",tags:[],version:"current",frontMatter:{title:"Data sources"},sidebar:"docs",previous:{title:"Modeling data",permalink:"/docs/modeling-data"},next:{title:"Updating data",permalink:"/docs/updating-data"}},d=[{value:"Base class",id:"base-class",children:[],level:2},{value:"Standard interfaces",id:"standard-interfaces",children:[{value:"Events",id:"events",children:[],level:3},{value:"Data flows",id:"data-flows",children:[],level:3},{value:"Developer-facing interfaces",id:"developer-facing-interfaces",children:[],level:3}],level:2}],c={toc:d};function m(e){var t=e.components,a=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Sources provide access to data. They vary widely in their capabilities: some\nsupport interfaces for updating and/or querying records, while others simply\nbroadcast changes."),(0,i.kt)("p",null,'Orbit includes a number of "standard" record-specific sources:'),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/api/memory/"},"@orbit/memory")," - an in-memory source"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/api/jsonapi/"},"@orbit/jsonapi")," - a JSON:API client"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/api/indexeddb/"},"@orbit/indexeddb")," - for accessing IndexedDB"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/api/local-storage/"},"@orbit/local-storage")," - for accessing LocalStorage")),(0,i.kt)("p",null,"Custom sources can also be written to access to virtually any source of data."),(0,i.kt)("h2",{id:"base-class"},"Base class"),(0,i.kt)("p",null,"Every source derives from an abstract base class,\n",(0,i.kt)("a",{parentName:"p",href:"/docs/api/data/classes/Source"},(0,i.kt)("inlineCode",{parentName:"a"},"Source")),", which has a core set of capabilities."),(0,i.kt)("p",null,"Sources must be instantiated with a schema. A schema provides sources with an\nunderstanding of the domain-specific data they manage."),(0,i.kt)("p",null,"Let's create a simple schema and memory source:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { RecordSchema } from '@orbit/records';\nimport { MemorySource } from '@orbit/memory';\n\n// Create a schema\nconst schema = new RecordSchema({\n  models: {\n    planet: {\n      attributes: {\n        name: { type: 'string' },\n        classification: { type: 'string' }\n      }\n    }\n  }\n});\n\n// Create a memory source that uses the schema\nconst memory = new MemorySource({ schema });\n")),(0,i.kt)("p",null,"All sources can be mutated, although not all sources support ",(0,i.kt)("em",{parentName:"p"},"requests")," to\nmutate. Some sources may only reflect mutations that come from elsewhere, such\nas a source that wraps server-sent events."),(0,i.kt)("p",null,'Because all mutations in Orbit are trackable, sources maintain a log of changes,\nor "transforms". This log represents an ordered history of transforms that have\nbeen applied to a source. The size of this log can be kept in check by\ntruncating it after related sources have been synchronized.'),(0,i.kt)("p",null,'Sources are also all "evented", meaning that they can emit events which\nlisteners can subscribe to. All sources support an event, ',(0,i.kt)("inlineCode",{parentName:"p"},"transform"),", that is\nemitted when that source changes. Most sources emit additional events as well\n(the specifics depend upon their capabilities)."),(0,i.kt)("p",null,"Let's look at an example of a simple mutation triggered by a call to ",(0,i.kt)("inlineCode",{parentName:"p"},"update"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"// Define a record\nconst jupiter = {\n  type: 'planet',\n  id: 'jupiter',\n  attributes: {\n    name: 'Jupiter',\n    classification: 'gas giant'\n  }\n};\n\n// Observe and log all transforms\nmemory.on('transform', (t) => {\n  console.log('transform', t);\n});\n\n// Check the size of the transform log before updates\nconsole.log(`transforms: ${memory.transformLog.length}`);\n\n// Update the memory source with a transform that adds a record\nawait memory.update((t) => t.addRecord(jupiter));\n\n// Verify that the transform log has grown\nconsole.log(`transforms: ${memory.transformLog.length}`);\n")),(0,i.kt)("p",null,"The following should be logged as a result:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"'transforms: 0',\n  'transform',\n  {\n    operations: [\n      {\n        op: 'addRecord',\n        record: {\n          type: 'planet',\n          id: 'jupiter',\n          attributes: {\n            name: 'Jupiter',\n            classification: 'gas giant'\n          }\n        }\n      }\n    ],\n    options: undefined,\n    id: '05e5d20e-02c9-42c4-a083-99662c647fd1'\n  },\n  'transforms: 1';\n")),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Want to learn more about updating data? ",(0,i.kt)("a",{parentName:"p",href:"/docs/updating-data"},"See the guide")))),(0,i.kt)("h2",{id:"standard-interfaces"},"Standard interfaces"),(0,i.kt)("p",null,"Orbit includes a number of standard interfaces that may be implemented by\nsources:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"/docs/api/data/interfaces/Updatable"},(0,i.kt)("inlineCode",{parentName:"a"},"Updatable"))," - Allows sources to be\nupdated via an ",(0,i.kt)("inlineCode",{parentName:"p"},"update")," method that takes a transform and returns the updated\nrecords that result.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"/docs/api/data/interfaces/Queryable"},(0,i.kt)("inlineCode",{parentName:"a"},"Queryable"))," - Allows sources to be\nqueried via a ",(0,i.kt)("inlineCode",{parentName:"p"},"query")," method that receives a query expression and returns a\nrecordset as a result.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"/docs/api/data/interfaces/Syncable"},(0,i.kt)("inlineCode",{parentName:"a"},"Syncable"))," - Applies a transform or\ntransforms to a source via a ",(0,i.kt)("inlineCode",{parentName:"p"},"sync")," method."))),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"Pullable")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Pushable")," interfaces have been deprecated in\nv0.17 and are scheduled to be removed in v0.18."))),(0,i.kt)("h3",{id:"events"},"Events"),(0,i.kt)("p",null,"All of the interfaces above emit events that share a common pattern. For an\ninterface with a given method ",(0,i.kt)("inlineCode",{parentName:"p"},"x"),", the following events will be emitted:\n",(0,i.kt)("inlineCode",{parentName:"p"},"beforeX"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"x"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"xFail"),". For example, updatable sources have an ",(0,i.kt)("inlineCode",{parentName:"p"},"update"),"\nmethod and can emit ",(0,i.kt)("inlineCode",{parentName:"p"},"beforeUpdate"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"update"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"updateFail")," events."),(0,i.kt)("p",null,"In addition, any mutations caused by calling ",(0,i.kt)("inlineCode",{parentName:"p"},"x")," will also be emitted with the\ngeneral ",(0,i.kt)("inlineCode",{parentName:"p"},"transform")," event."),(0,i.kt)("p",null,"Processing occurs as follows (feel free to substitute ",(0,i.kt)("inlineCode",{parentName:"p"},"update"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"query"),", etc.\nfor ",(0,i.kt)("inlineCode",{parentName:"p"},"x"),"):"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"x")," is called on a source.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"beforeX")," event is emitted by the source. Any promises that are returned\nfrom listeners will be settled serially. Any errors encountered will prevent\nfurther processing and cause the source to emit the ",(0,i.kt)("inlineCode",{parentName:"p"},"xFail")," event.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"x")," is processed internally by the source. Any errors encountered will\nprevent further processing and cause the source to emit the ",(0,i.kt)("inlineCode",{parentName:"p"},"xFail")," event.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"transform")," event is emitted if ",(0,i.kt)("inlineCode",{parentName:"p"},"x")," resulted in any mutations. Any\npromises that are returned from listeners will be settled serially. Errors\nwill NOT prevent further processing.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"x")," event is emitted. Any promises that are returned\nfrom listeners will be settled serially. Errors will NOT prevent further\nprocessing."))),(0,i.kt)("p",null,"There's a clear turning point after ",(0,i.kt)("inlineCode",{parentName:"p"},"x")," has been processed internally by the\nsource. While listeners can block processing of ",(0,i.kt)("inlineCode",{parentName:"p"},"x")," in the ",(0,i.kt)("inlineCode",{parentName:"p"},"beforeX")," event by\nreturning a promise that fails, after ",(0,i.kt)("inlineCode",{parentName:"p"},"x")," has been processed such failures will\nbe ignored by the emitter."),(0,i.kt)("h3",{id:"data-flows"},"Data flows"),(0,i.kt)("p",null,"The ",(0,i.kt)("a",{parentName:"p",href:"/docs/api/data/interfaces/Updatable"},(0,i.kt)("inlineCode",{parentName:"a"},"Updatable"))," and\n",(0,i.kt)("a",{parentName:"p",href:"/docs/api/data/interfaces/Queryable"},(0,i.kt)("inlineCode",{parentName:"a"},"Queryable")),' interfaces participate in the\n"request flow", in which requests are made upstream and data flows back down.'),(0,i.kt)("p",null,"The ",(0,i.kt)("a",{parentName:"p",href:"/docs/api/data/interfaces/Syncable"},(0,i.kt)("inlineCode",{parentName:"a"},"Syncable")),' interface participates in\nthe "sync flow", in which data flowing downstream is synchronized with other\nsources.'),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Want to learn more about data flows? ",(0,i.kt)("a",{parentName:"p",href:"/docs/data-flows"},"See the guide")))),(0,i.kt)("h3",{id:"developer-facing-interfaces"},"Developer-facing interfaces"),(0,i.kt)("p",null,"Generally speaking, developers will primarily interact the\n",(0,i.kt)("a",{parentName:"p",href:"/docs/api/data/interfaces/Updatable"},(0,i.kt)("inlineCode",{parentName:"a"},"Updatable"))," and\n",(0,i.kt)("a",{parentName:"p",href:"/docs/api/data/interfaces/Queryable"},(0,i.kt)("inlineCode",{parentName:"a"},"Queryable"))," interfaces. The\n",(0,i.kt)("a",{parentName:"p",href:"/docs/api/data/interfaces/Syncable"},(0,i.kt)("inlineCode",{parentName:"a"},"Syncable"))," interface is used primarily via\ncoordination strategies."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"See more specific guides that cover:"),(0,i.kt)("ul",{parentName:"div"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/updating-data"},"Updating data")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/querying-data"},"Querying data")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/coordination"},"Coordination strategies"))))))}m.isMDXComponent=!0}}]);