
<!DOCTYPE html>
<html lang="en">
    <head><meta name="generator" content="Hexo 3.8.0">
        <title>Task processing - Orbit.js</title>
        <meta charset="utf-8">
        <meta name="description" content="A framework for orchestrating access, transformation, and synchronization between data sources.">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

        <meta property="og:type" content="article">
        <meta property="og:title" content="Task processing - Orbit.js">
        <meta property="og:description" content="A framework for orchestrating access, transformation, and synchronization between data sources.">
        <meta property="og:image" content="http://orbitjs.com/images/logo.png">

        <meta name="twitter:card" content="summary">
        <meta name="twitter:title" content="Task processing - Orbit.js">
        <meta name="twitter:description" content="A framework for orchestrating access, transformation, and synchronization between data sources.">
        <meta name="twitter:image" content="http://orbitjs.com/images/logo.png">

        <!-- ****** faviconit.com favicons ****** -->
      	<link rel="shortcut icon" href="/favicon.ico">
      	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
      	<link rel="icon" type="image/png" sizes="196x196" href="/favicon-192.png">
      	<link rel="icon" type="image/png" sizes="160x160" href="/favicon-160.png">
      	<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96.png">
      	<link rel="icon" type="image/png" sizes="64x64" href="/favicon-64.png">
      	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
      	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png">
      	<link rel="apple-touch-icon" href="/favicon-57.png">
      	<link rel="apple-touch-icon" sizes="114x114" href="/favicon-114.png">
      	<link rel="apple-touch-icon" sizes="72x72" href="/favicon-72.png">
      	<link rel="apple-touch-icon" sizes="144x144" href="/favicon-144.png">
      	<link rel="apple-touch-icon" sizes="60x60" href="/favicon-60.png">
      	<link rel="apple-touch-icon" sizes="120x120" href="/favicon-120.png">
      	<link rel="apple-touch-icon" sizes="76x76" href="/favicon-76.png">
      	<link rel="apple-touch-icon" sizes="152x152" href="/favicon-152.png">
      	<link rel="apple-touch-icon" sizes="180x180" href="/favicon-180.png">
      	<meta name="msapplication-TileColor" content="#FFFFFF">
      	<meta name="msapplication-TileImage" content="/favicon-144.png">
      	<meta name="msapplication-config" content="/browserconfig.xml">
      	<!-- ****** faviconit.com favicons ****** -->
        <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">

        <!-- main page styles -->
        <link rel="stylesheet" href="/css/page.css">

        <!-- this needs to be loaded before guide's inline scripts -->
        <script>window.PAGE_TYPE = "guide"</script>

        <!-- ga -->
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-1632329-6', 'auto');
            ga('send', 'pageview');
        </script>
    </head>
    <body class="docs">        <div id="mobile-bar">
            <a class="menu-button"></a>
            <a class="logo" href="/"></a>
        </div>
        <div id="header">
  <a id="logo" href="/">
    <img src="/images/orbitjs.png" alt="Orbit.js">
  </a>
  <ul id="nav">
    <li><a href="/v0.15/guide/" class="nav-link current">Guide</a></li>
<li><a href="/sponsor/" class="nav-link">Sponsor</a></li>
<li><a href="https://github.com/orbitjs/orbit" class="nav-link">GitHub</a></li>
<li class="nav-dropdown-container">
  <a class="nav-link">Community</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li class="nav-gitter"><a href="https://gitter.im/orbitjs/orbit.js" class="nav-link" target="_blank">Chat</a></li>
    <li class="nav-twitter"><a href="https://twitter.com/orbitjs" class="nav-link" target="_blank">Twitter</a></li>
  </ul>
</li>


  </ul>
</div>

        
            <div id="main" class="fix-sidebar">
                
                    
    <div class="sidebar">
    <ul class="main-menu">
        <li><a href="/v0.15/guide/" class="nav-link current">Guide</a></li>
<li><a href="/sponsor/" class="nav-link">Sponsor</a></li>
<li><a href="https://github.com/orbitjs/orbit" class="nav-link">GitHub</a></li>
<li class="nav-dropdown-container">
  <a class="nav-link">Community</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li class="nav-gitter"><a href="https://gitter.im/orbitjs/orbit.js" class="nav-link" target="_blank">Chat</a></li>
    <li class="nav-twitter"><a href="https://twitter.com/orbitjs" class="nav-link" target="_blank">Twitter</a></li>
  </ul>
</li>


    </ul>
    <div class="list">
        <h2>
            Guide
            <select class="version-select">
                
                <option value="0.15" selected>v0.15</option>
                
            </select>
        </h2>
        <div id="donate" style="margin-bottom: 20px">
            <img src="/images/paypal.png">
            <a href="/sponsor">Sponsor Orbit.js</a>
        </div>
        <ul class="menu-root">
            
            
            
                
                <li>
                    <a href="/v0.15/guide/index.html" class="sidebar-link">Introduction</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/packages.html" class="sidebar-link">Packages</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/getting-started.html" class="sidebar-link">Getting started</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/modeling-data.html" class="sidebar-link">Modeling data</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/data-sources.html" class="sidebar-link">Data sources</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/updating-data.html" class="sidebar-link">Updating data</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/querying-data.html" class="sidebar-link">Querying data</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/task-processing.html" class="sidebar-link current">Task processing</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/data-flows.html" class="sidebar-link">Data flows</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/coordination.html" class="sidebar-link">Coordination strategies</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/data-stores.html" class="sidebar-link">Data stores</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/license.html" class="sidebar-link">License</a>
                </li>
            
        </ul>
    </div>
</div>


<div class="content guide with-sidebar task-processing-guide">
  
    <h1>Task processing</h1>
  
  <p>Tasks and queues are primitives contained in <code>@orbit/core</code> that are useful for
processing actions asynchronously and serially.</p>
<p>Although you’ll typically work with tasks indirectly, understanding these
concepts can help you better troubleshoot and harden your Orbit applications.</p>
<h2 id="Tasks"><a href="#Tasks" class="headerlink" title="Tasks"></a>Tasks</h2><p>Every action performed by sources, from updates to queries, is considered a
“task” to be performed asynchronously.</p>
<p>The <code>Task</code> interface is simply:</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> Task &#123;</span><br><span class="line">  <span class="keyword">type</span>: <span class="built_in">string</span>;</span><br><span class="line">  id?: <span class="built_in">string</span>;</span><br><span class="line">  data?: <span class="built_in">any</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>A task’s <code>type</code>, such as <code>&quot;query&quot;</code> or <code>&quot;update&quot;</code>, signals how that task should
be performed. An <code>id</code> is assigned to uniquely identify the task. And <code>data</code>
should contain the type-specific data needed to perform the task, such as an
object that conforms with the <code>Query</code> or <code>Transform</code> interfaces.</p>
<h2 id="Performers"><a href="#Performers" class="headerlink" title="Performers"></a>Performers</h2><p>Tasks are performed asynchronously by a <code>Performer</code>:</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Performer &#123;</span><br><span class="line">  perform(task: Task): <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In <code>@orbit/data</code>, every <code>Source</code> implements the <code>Performer</code> interface.</p>
<h2 id="Task-queues"><a href="#Task-queues" class="headerlink" title="Task queues"></a>Task queues</h2><p>Tasks can be added to queues, which act as FIFO stacks that perform each task
serially and asynchronously.</p>
<p>Task queues are associated with a single <code>performer</code>, such as a <code>Source</code>, that
will perform each task. A <code>performer</code> must be assigned when instantiating a
<code>TaskQueue</code>:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> queue = <span class="keyword">new</span> TaskQueue(source); <span class="comment">// `source` implements `Performer`</span></span><br></pre></td></tr></table></figure>
<p>By default, task queues automatically process any tasks that are added to them
and will continue until either all tasks have been performed or a problem has
been encountered. For finer control over processing, it’s possible to
instantiate a queue that will only process tasks explicitly:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> queue = <span class="keyword">new</span> TaskQueue(source, &#123; <span class="attr">autoProcess</span>: <span class="literal">false</span> &#125;);</span><br></pre></td></tr></table></figure>
<p>Tasks are normally added to the end of a queue via the <code>push</code> method:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">queue.push(&#123;</span><br><span class="line">  type: <span class="string">'query'</span>,</span><br><span class="line">  data: &#123; <span class="attr">expression</span>: &#123; <span class="attr">op</span>: <span class="string">'findRecords'</span>, <span class="attr">type</span>: <span class="string">'planet'</span> &#125; &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Task-processing"><a href="#Task-processing" class="headerlink" title="Task processing"></a>Task processing</h3><p>Depending upon whether a queue is set to <code>autoProcess</code>, task processing will
start either immediately or after the <code>process</code> method has been called.</p>
<p>Queues emit the following events when processing tasks:</p>
<ul>
<li><p><code>change</code> - whenever a task has been added or removed to a queue</p>
</li>
<li><p><code>beforeTask</code> - before processing of a task begins</p>
</li>
<li><p><code>task</code> - after a task has been processed successfully</p>
</li>
<li><p><code>fail</code> - when a task has failed to process</p>
</li>
<li><p><code>complete</code> - when all tasks have been processed</p>
</li>
</ul>
<p>As each task is processed successfully, it will be removed from the queue.</p>
<p>If processing fails, the queue will emit the <code>fail</code> event and processing will
stop. At that point, you have several options:</p>
<ul>
<li><p><code>retry()</code> will retry the task that failed.</p>
</li>
<li><p><code>skip()</code> will cancel and discard the current task and proceed to
process the next task.</p>
</li>
<li><p><code>clear()</code> will cancel the current task and completely clear the queue.</p>
</li>
<li><p><code>shift()</code> will cancel the current task and remove it, but will not continue
processing.</p>
</li>
<li><p><code>unshift(newTask)</code> will cancel the current task and insert a new task in front
of it at the beginning of the queue.</p>
</li>
</ul>
<p>These options provide fairly complete control over task processing, which can
prove useful when handling exceptions, debugging, and testing.</p>
<h3 id="Task-queues-for-sources"><a href="#Task-queues-for-sources" class="headerlink" title="Task queues for sources"></a>Task queues for sources</h3><p>Every <code>Source</code> in <code>@orbit/data</code> maintains two task queues:</p>
<ul>
<li><p>A <code>requestQueue</code> for processing requests, such as updates and queries.</p>
</li>
<li><p>A <code>syncQueue</code> for synchronizing changes between sources.</p>
</li>
</ul>
<p>These queues are discussed in more detail as part of the guide on “data flows”.</p>

  
    <div class="guide-links">
      
        <span>← <a href="/v0.15/guide/querying-data.html">Querying data</a></span>
      
      
        <span style="float:right"><a href="/v0.15/guide/data-flows.html">Data flows</a> →</span>
      
    </div>
  
  <div class="footer">
    Want to correct or improve this documentation?
    <a href="https://github.com/orbitjs/orbitjs-site/blob/master/src/v0.15/guide/task-processing.md" target="_blank">
      Edit this page on Github!
    </a>
  </div>
</div>

                
            </div>
            <script src="/js/smooth-scroll.min.js"></script>
        

        <!-- main custom script for sidebars, version selects etc. -->
        <script src="/js/common.js"></script>

        <!-- fastclick -->
        <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
        <script>
        document.addEventListener('DOMContentLoaded', function() {
          FastClick.attach(document.body)
        }, false)
        </script>
    </body>
</html>
