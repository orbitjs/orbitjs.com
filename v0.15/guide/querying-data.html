
<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Querying data - Orbit.js</title>
        <meta charset="utf-8">
        <meta name="description" content="A framework for orchestrating access, transformation, and synchronization between data sources.">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

        <meta property="og:type" content="article">
        <meta property="og:title" content="Querying data - Orbit.js">
        <meta property="og:description" content="A framework for orchestrating access, transformation, and synchronization between data sources.">
        <meta property="og:image" content="http://http://orbitjs.com/images/logo.png">

        <meta name="twitter:card" content="summary">
        <meta name="twitter:title" content="Querying data - Orbit.js">
        <meta name="twitter:description" content="A framework for orchestrating access, transformation, and synchronization between data sources.">
        <meta name="twitter:image" content="http://http://orbitjs.com/images/logo.png">

        <!-- ****** faviconit.com favicons ****** -->
      	<link rel="shortcut icon" href="/favicon.ico">
      	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
      	<link rel="icon" type="image/png" sizes="196x196" href="/favicon-192.png">
      	<link rel="icon" type="image/png" sizes="160x160" href="/favicon-160.png">
      	<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96.png">
      	<link rel="icon" type="image/png" sizes="64x64" href="/favicon-64.png">
      	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
      	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png">
      	<link rel="apple-touch-icon" href="/favicon-57.png">
      	<link rel="apple-touch-icon" sizes="114x114" href="/favicon-114.png">
      	<link rel="apple-touch-icon" sizes="72x72" href="/favicon-72.png">
      	<link rel="apple-touch-icon" sizes="144x144" href="/favicon-144.png">
      	<link rel="apple-touch-icon" sizes="60x60" href="/favicon-60.png">
      	<link rel="apple-touch-icon" sizes="120x120" href="/favicon-120.png">
      	<link rel="apple-touch-icon" sizes="76x76" href="/favicon-76.png">
      	<link rel="apple-touch-icon" sizes="152x152" href="/favicon-152.png">
      	<link rel="apple-touch-icon" sizes="180x180" href="/favicon-180.png">
      	<meta name="msapplication-TileColor" content="#FFFFFF">
      	<meta name="msapplication-TileImage" content="/favicon-144.png">
      	<meta name="msapplication-config" content="/browserconfig.xml">
      	<!-- ****** faviconit.com favicons ****** -->
        <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono' rel='stylesheet' type='text/css'>

        <!-- main page styles -->
        <link rel="stylesheet" href="/css/page.css">

        <!-- this needs to be loaded before guide's inline scripts -->
        <script>window.PAGE_TYPE = "guide"</script>

        <!-- ga -->
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-1632329-6', 'auto');
            ga('send', 'pageview');
        </script>
    </head>
    <body class="docs">        <div id="mobile-bar" >
            <a class="menu-button"></a>
            <a class="logo" href="/"></a>
        </div>
        <div id="header">
  <a id="logo" href="/">
    <img src="/images/orbitjs.png" alt="Orbit.js">
  </a>
  <ul id="nav">
    <li><a href="/v0.15/guide/" class="nav-link current">Guide</a></li>
<li><a href="/sponsor/" class="nav-link">Sponsor</a></li>
<li><a href="https://github.com/orbitjs/orbit" class="nav-link">GitHub</a></li>
<li class="nav-dropdown-container">
  <a class="nav-link">Community</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li class="nav-gitter"><a href="https://gitter.im/orbitjs/orbit.js" class="nav-link" target="_blank">Chat</a></li>
    <li class="nav-twitter"><a href="https://twitter.com/orbitjs" class="nav-link" target="_blank">Twitter</a></li>
  </ul>
</li>


  </ul>
</div>

        
            <div id="main" class="fix-sidebar">
                
                    
    <div class="sidebar">
    <ul class="main-menu">
        <li><a href="/v0.15/guide/" class="nav-link current">Guide</a></li>
<li><a href="/sponsor/" class="nav-link">Sponsor</a></li>
<li><a href="https://github.com/orbitjs/orbit" class="nav-link">GitHub</a></li>
<li class="nav-dropdown-container">
  <a class="nav-link">Community</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li class="nav-gitter"><a href="https://gitter.im/orbitjs/orbit.js" class="nav-link" target="_blank">Chat</a></li>
    <li class="nav-twitter"><a href="https://twitter.com/orbitjs" class="nav-link" target="_blank">Twitter</a></li>
  </ul>
</li>


    </ul>
    <div class="list">
        <h2>
            Guide
            <select class="version-select">
                
                <option value="0.15" selected >v0.15</option>
                
            </select>
        </h2>
        <div id="donate" style="margin-bottom: 20px">
            <img src="/images/paypal.png">
            <a href="/sponsor">Sponsor Orbit.js</a>
        </div>
        <ul class="menu-root">
            
            
            
                
                <li>
                    <a href="/v0.15/guide/index.html" class="sidebar-link">Introduction</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/packages.html" class="sidebar-link">Packages</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/getting-started.html" class="sidebar-link">Getting started</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/modeling-data.html" class="sidebar-link">Modeling data</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/data-sources.html" class="sidebar-link">Data sources</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/updating-data.html" class="sidebar-link">Updating data</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/querying-data.html" class="sidebar-link current">Querying data</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/task-processing.html" class="sidebar-link">Task processing</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/data-flows.html" class="sidebar-link">Data flows</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/coordination.html" class="sidebar-link">Coordination strategies</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/data-stores.html" class="sidebar-link">Data stores</a>
                </li>
            
                
                <li>
                    <a href="/v0.15/guide/license.html" class="sidebar-link">License</a>
                </li>
            
        </ul>
    </div>
</div>


<div class="content guide with-sidebar querying-data-guide">
  
    <h1>Querying data</h1>
  
  <p>The contents of a source can be interrogated using a <code>Query</code>. Orbit comes with a
standard set of query expressions for finding records and related records. These
expressions can be paired with refinements (e.g. filters, sort order, etc.).</p>
<p>Custom query expressions can also be developed, as long as all the sources
participating can understand them.</p>
<h2 id="Query-expressions"><a href="#Query-expressions" class="headerlink" title="Query expressions"></a>Query expressions</h2><p>The <code>QueryExpression</code> interface requires one member:</p>
<ul>
<li><code>op</code> - a string identifying the type of query operation</li>
</ul>
<p>The other members of a <code>QueryExpression</code> are specific to the <code>op</code>.</p>
<p>The following standard query expressions are defined in <code>@orbit/data</code>:</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">interface</span> QueryExpression &#123;</div><div class="line">  op: <span class="built_in">string</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">interface</span> FindRecord <span class="keyword">extends</span> QueryExpression &#123;</div><div class="line">  op: <span class="string">'findRecord'</span>;</div><div class="line">  record: RecordIdentity;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">interface</span> FindRelatedRecord <span class="keyword">extends</span> QueryExpression &#123;</div><div class="line">  op: <span class="string">'findRelatedRecord'</span>;</div><div class="line">  record: RecordIdentity;</div><div class="line">  relationship: <span class="built_in">string</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">interface</span> FindRelatedRecords <span class="keyword">extends</span> QueryExpression &#123;</div><div class="line">  op: <span class="string">'findRelatedRecords'</span>;</div><div class="line">  record: RecordIdentity;</div><div class="line">  relationship: <span class="built_in">string</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">interface</span> FindRecords <span class="keyword">extends</span> QueryExpression &#123;</div><div class="line">  op: <span class="string">'findRecords'</span>;</div><div class="line">  <span class="keyword">type</span>?: <span class="built_in">string</span>;</div><div class="line">  sort?: SortSpecifier[];</div><div class="line">  filter?: FilterSpecifier[];</div><div class="line">  page?: PageSpecifier;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Supporting interfaces include:</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">type</span> SortOrder = <span class="string">'ascending'</span> | <span class="string">'descending'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">interface</span> SortSpecifier &#123;</div><div class="line">  kind: <span class="built_in">string</span>;</div><div class="line">  order: SortOrder;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">interface</span> AttributeSortSpecifier <span class="keyword">extends</span> SortSpecifier &#123;</div><div class="line">  kind: <span class="string">'attribute'</span>;</div><div class="line">  attribute: <span class="built_in">string</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">type</span> ComparisonOperator = <span class="string">'equal'</span> | <span class="string">'gt'</span> | <span class="string">'lt'</span> | <span class="string">'gte'</span> | <span class="string">'lte'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">interface</span> FilterSpecifier &#123;</div><div class="line">  op: ComparisonOperator;</div><div class="line">  kind: <span class="built_in">string</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">interface</span> AttributeFilterSpecifier <span class="keyword">extends</span> FilterSpecifier &#123;</div><div class="line">  kind: <span class="string">'attribute'</span>;</div><div class="line">  attribute: <span class="built_in">string</span>;</div><div class="line">  value: <span class="built_in">any</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">interface</span> PageSpecifier &#123;</div><div class="line">  kind: <span class="built_in">string</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">interface</span> OffsetLimitPageSpecifier <span class="keyword">extends</span> PageSpecifier &#123;</div><div class="line">  kind: <span class="string">'offsetLimit'</span>;</div><div class="line">  offset?: <span class="built_in">number</span>;</div><div class="line">  limit?: <span class="built_in">number</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Queries"><a href="#Queries" class="headerlink" title="Queries"></a>Queries</h2><p>The <code>Query</code> interface has the following members:</p>
<ul>
<li><code>id</code> - a string that uniquely identifies the query</li>
<li><code>expression</code> - a <code>QueryExpression</code> object</li>
<li><code>options</code> - an optional object that represents options that can influence how
a query is processed</li>
</ul>
<p>Although queries can be created “manually”, you’ll probably find it easier
to use a builder function that returns a query.</p>
<p>To use a query builder, pass a function into a source’s method that expects
a query, such as <code>query</code> or <code>pull</code>. A <code>QueryBuilder</code> that’s compatible
with the source should be applied as an argument. You can then use this builder
to create a query expression.</p>
<h3 id="Standard-queries"><a href="#Standard-queries" class="headerlink" title="Standard queries"></a>Standard queries</h3><p>You can use the standard <code>@orbit/data</code> query builder as follows:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Find a single record by identity</span></div><div class="line">store.query(<span class="function"><span class="params">q</span> =&gt;</span> q.findRecord(&#123; <span class="attr">type</span>: <span class="string">'planet'</span>, <span class="attr">id</span>: <span class="string">'earth'</span> &#125;));</div><div class="line"></div><div class="line"><span class="comment">// Find all records by type</span></div><div class="line">store.query(<span class="function"><span class="params">q</span> =&gt;</span> q.findRecords(<span class="string">'planet'</span>));</div><div class="line"></div><div class="line"><span class="comment">// Find a related record in a to-one relationship</span></div><div class="line">store.query(<span class="function"><span class="params">q</span> =&gt;</span> q.findRelatedRecord(&#123; <span class="attr">type</span>: <span class="string">'moon'</span>, <span class="attr">id</span>: <span class="string">'io'</span> &#125;, <span class="string">'planet'</span>));</div><div class="line"></div><div class="line"><span class="comment">// Find related records in a to-many relationship</span></div><div class="line">store.query(<span class="function"><span class="params">q</span> =&gt;</span> q.findRelatedRecords(&#123; <span class="attr">type</span>: <span class="string">'planet'</span>, <span class="attr">id</span>: <span class="string">'earth'</span> &#125;, <span class="string">'moons'</span>));</div></pre></td></tr></table></figure>
<p>The base <code>findRecord</code> query can be enhanced significantly:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Sort by name</span></div><div class="line">store.query(<span class="function"><span class="params">q</span> =&gt;</span> q.findRecords(<span class="string">'planet'</span>)</div><div class="line">                  .sort(<span class="string">'name'</span>));</div><div class="line"></div><div class="line"><span class="comment">// Sort by classification, then name (descending)</span></div><div class="line">store.query(<span class="function"><span class="params">q</span> =&gt;</span> q.findRecords(<span class="string">'planet'</span>)</div><div class="line">                  .sort(<span class="string">'classification'</span>, <span class="string">'-name'</span>));</div><div class="line"></div><div class="line"><span class="comment">// Filter by a single attribute</span></div><div class="line">store.query(<span class="function"><span class="params">q</span> =&gt;</span> q.findRecords(<span class="string">'planet'</span>)</div><div class="line">                  .filter(&#123; <span class="attr">attribute</span>: <span class="string">'classification'</span>, <span class="attr">value</span>: <span class="string">'terrestrial'</span> &#125;)</div><div class="line"></div><div class="line"><span class="comment">// Filter by multiple attributes</span></div><div class="line">store.query(<span class="function"><span class="params">q</span> =&gt;</span> q.findRecords(<span class="string">'planet'</span>)</div><div class="line">                  .filter(&#123; <span class="attr">attribute</span>: <span class="string">'classification'</span>, <span class="attr">value</span>: <span class="string">'terrestrial'</span> &#125;,</div><div class="line">                          &#123; <span class="attr">attribute</span>: <span class="string">'mass'</span>, <span class="attr">op</span>: <span class="string">'gt'</span>, <span class="attr">value</span>: <span class="number">987654321</span> &#125;)</div><div class="line"></div><div class="line"><span class="comment">// Paginate by offset and limit</span></div><div class="line">store.query(<span class="function"><span class="params">q</span> =&gt;</span> q.findRecords(<span class="string">'planet'</span>)</div><div class="line">                  .page(&#123; <span class="attr">offset</span>: <span class="number">0</span>, <span class="attr">limit</span>: <span class="number">10</span> &#125;));</div><div class="line"></div><div class="line"><span class="comment">// Combine filtering, sorting, and paginating</span></div><div class="line">store.query(<span class="function"><span class="params">q</span> =&gt;</span> q.findRecords(<span class="string">'planet'</span>)</div><div class="line">                  .filter(&#123; <span class="attr">attribute</span>: <span class="string">'classification'</span>, <span class="attr">value</span>: <span class="string">'terrestrial'</span> &#125;)</div><div class="line">                  .sort(<span class="string">'name'</span>)</div><div class="line">                  .page(&#123; <span class="attr">offset</span>: <span class="number">0</span>, <span class="attr">limit</span>: <span class="number">10</span> &#125;));</div></pre></td></tr></table></figure>
<h3 id="Query-options"><a href="#Query-options" class="headerlink" title="Query options"></a>Query options</h3><p>Options can be added to queries to provide processing instructions to particular
sources and to include metadata about queries.</p>
<p>For example, the following query is given a <code>label</code> and contains instructions
for the source named <code>remote</code>:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">store.query(<span class="function"><span class="params">q</span> =&gt;</span> q.findRecords(<span class="string">'contact'</span>).sort(<span class="string">'lastName'</span>, <span class="string">'firstName'</span>), &#123;</div><div class="line">  <span class="attr">label</span>: <span class="string">'Find all contacts'</span>,</div><div class="line">  <span class="attr">sources</span>: &#123;</div><div class="line">    <span class="attr">remote</span>: &#123;</div><div class="line">      <span class="attr">include</span>: [<span class="string">'phone-numbers'</span>]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>A <code>label</code> can be useful for providing an understanding of actions that have been
queued for processing.</p>
<p>The <code>sources: ( ${sourceName}: sourceSpecificOptions }</code> pattern is used to pass
options that only a particular source will understand when processing a query.
In this instance, we’re telling a source named <code>remote</code> (let’s say it’s a
<code>JSONAPISource</code>) to include <code>include=phone-numbers</code> as a query param. This will
result in a server response that includes contacts together with their related
phone numbers.</p>
<h2 id="Querying-a-store’s-cache"><a href="#Querying-a-store’s-cache" class="headerlink" title="Querying a store’s cache"></a>Querying a store’s cache</h2><p>Note that <code>store.query</code> is asynchronous and thus returns results wrapped in a
promise. This may seem strange at first because the store’s data is “in memory”.
In fact, if you want to just “peek” into the contents of the store’s memory,
you can issue the same queries synchronously against the store’s <code>Cache</code>.
For example:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Results will be returned synchronously by querying the cache</span></div><div class="line"><span class="keyword">let</span> planets = store.cache.query(<span class="function"><span class="params">q</span> =&gt;</span> q.findRecords(<span class="string">'planet'</span>).sort(<span class="string">'name'</span>));</div></pre></td></tr></table></figure>
<blockquote>
<p>By querying the cache instead of the store, you’re not allowing other
sources to participate in the fulfillment of the query. If you want to
coordinate queries across multiple sources, it’s critical to make requests
directly on the store.</p>
</blockquote>

  
    <div class="guide-links">
      
        <span>← <a href="/v0.15/guide/updating-data.html">Updating data</a></span>
      
      
        <span style="float:right"><a href="/v0.15/guide/task-processing.html">Task processing</a> →</span>
      
    </div>
  
  <div class="footer">
    Want to correct or improve this documentation?
    <a href="https://github.com/orbitjs/orbitjs-site/blob/master/src/v0.15/guide/querying-data.md" target="_blank">
      Edit this page on Github!
    </a>
  </div>
</div>

                
            </div>
            <script src="/js/smooth-scroll.min.js"></script>
        

        <!-- main custom script for sidebars, version selects etc. -->
        <script src="/js/common.js"></script>

        <!-- fastclick -->
        <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
        <script>
        document.addEventListener('DOMContentLoaded', function() {
          FastClick.attach(document.body)
        }, false)
        </script>
    </body>
</html>
